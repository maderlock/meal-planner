generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email       String       @unique
  firebaseUid String       @unique @map("firebase_uid")
  username    String
  createdAt   DateTime     @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime     @updatedAt @map("updated_at") @db.Timestamptz
  meals       Meal[]
  weeklyPlans WeeklyPlan[]

  @@map("users")
}

model Meal {
  id          String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String
  description String?
  isFavorite  Boolean      @default(false) @map("is_favorite")
  userId      String       @map("user_id") @db.Uuid
  createdAt   DateTime     @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime     @updatedAt @map("updated_at") @db.Timestamptz
  user        User         @relation(fields: [userId], references: [id])
  mealPlans   MealPlan[]

  @@map("meals")
}

model WeeklyPlan {
  id            String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId        String     @map("user_id") @db.Uuid
  weekStartDate DateTime   @map("week_start_date") @db.Date
  createdAt     DateTime   @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime   @updatedAt @map("updated_at") @db.Timestamptz
  user          User       @relation(fields: [userId], references: [id])
  mealPlans     MealPlan[]

  @@unique([userId, weekStartDate])
  @@map("weekly_plans")
}

model MealPlan {
  id           String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  weeklyPlanId String     @map("weekly_plan_id") @db.Uuid
  mealId       String     @map("meal_id") @db.Uuid
  dayOfWeek    Int        @map("day_of_week") // 1 = Monday, 7 = Sunday
  mealType     String     @map("meal_type") // 'lunch' or 'dinner'
  createdAt    DateTime   @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime   @updatedAt @map("updated_at") @db.Timestamptz
  weeklyPlan   WeeklyPlan @relation(fields: [weeklyPlanId], references: [id])
  meal         Meal       @relation(fields: [mealId], references: [id])

  @@unique([weeklyPlanId, dayOfWeek])
  @@map("meal_plans")
}
